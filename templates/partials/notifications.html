{% load i18n %}
<!-- Notifications Dropdown -->
<div class="dropdown">
    <button class="btn btn-outline-light dropdown-toggle position-relative" type="button" id="notificationsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-bell"></i>
        {% if notifications_count > 0 %}
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            {{ notifications_count }}
        </span>
        {% endif %}
    </button>
    <ul class="dropdown-menu dropdown-menu-end notification-dropdown" aria-labelledby="notificationsDropdown">
        <li class="dropdown-header d-flex justify-content-between align-items-center">
            <span>{% trans "Notifications" %}</span>
            <button class="btn btn-sm btn-outline-primary" onclick="markAllAsRead()">{% trans "Mark all as read" %}</button>
        </li>
        <li><hr class="dropdown-divider"></li>
        
        {% if notifications %}
            {% for notification in notifications %}
            <li class="notification-item {% if not notification.is_read %}unread{% endif %}">
                <div class="d-flex align-items-start">
                    <div class="notification-icon me-3">
                        {% if notification.type == 'transaction' %}
                            <i class="fas fa-dollar-sign text-success"></i>
                        {% elif notification.type == 'request' %}
                            <i class="fas fa-hand-holding-usd text-warning"></i>
                        {% elif notification.type == 'security' %}
                            <i class="fas fa-shield-alt text-danger"></i>
                        {% else %}
                            <i class="fas fa-info-circle text-info"></i>
                        {% endif %}
                    </div>
                    <div class="notification-content flex-grow-1">
                        <h6 class="notification-title mb-1">{{ notification.title }}</h6>
                        <p class="notification-message mb-1">{{ notification.message }}</p>
                        <small class="text-muted">{{ notification.created_at|timesince }} {% trans "ago" %}</small>
                    </div>
                    {% if not notification.is_read %}
                    <div class="notification-dot"></div>
                    {% endif %}
                </div>
            </li>
            {% if not forloop.last %}
            <li><hr class="dropdown-divider"></li>
            {% endif %}
            {% endfor %}
        {% else %}
            <li class="text-center py-3">
                <i class="fas fa-bell-slash text-muted" style="font-size: 2rem;"></i>
                <p class="text-muted mb-0 mt-2">{% trans "No notifications" %}</p>
            </li>
        {% endif %}
        
        <li><hr class="dropdown-divider"></li>
        <li class="text-center">
            <a href="#" class="btn btn-outline-primary btn-sm">{% trans "View all notifications" %}</a>
        </li>
    </ul>
</div>

<style>
.notification-dropdown {
    width: 350px;
    max-height: 400px;
    overflow-y: auto;
}

.notification-item {
    padding: 12px 16px;
    transition: background-color 0.2s ease;
}

.notification-item:hover {
    background-color: #f8f9fa;
}

.notification-item.unread {
    background-color: #e3f2fd;
    border-left: 3px solid #2196f3;
}

.notification-icon {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background-color: #f5f5f5;
}

.notification-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: #333;
    margin: 0;
}

.notification-message {
    font-size: 0.8rem;
    color: #666;
    margin: 0;
    line-height: 1.4;
}

.notification-dot {
    width: 8px;
    height: 8px;
    background-color: #2196f3;
    border-radius: 50%;
    margin-top: 8px;
}

.dropdown-header {
    padding: 12px 16px 8px;
    font-weight: 600;
    color: #333;
    background-color: #f8f9fa;
}

.dropdown-divider {
    margin: 8px 0;
}
</style>

<script>
function markAllAsRead() {
    // In a real app, you'd make an AJAX request to mark all as read
    fetch('/api/notifications/mark-all-read/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}
</script>

